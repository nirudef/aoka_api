# üèõÔ∏è API –ê–ª–º–∞—Ç–∏–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–Ω–æ–π –∫–æ–ª–ª–µ–≥–∏–∏ –∞–¥–≤–æ–∫–∞—Ç–æ–≤ (–ê–û–ö–ê)

> **RESTful API** –¥–ª—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞ –ê–û–ö–ê ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –ø—É–±–ª–∏–∫–∞—Ü–∏—è–º–∏, —Ñ–∏–ª–∏–∞–ª–∞–º–∏, —é—Ä–∏–¥–∏—á–µ—Å–∫–∏–º–∏ –∫–æ–Ω—Ç–æ—Ä–∞–º–∏ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏.

---

## üîó –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- **API (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)**: [https://api.aoka.kz/docs](https://api.aoka.kz/docs) *(Swagger, –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)*
- **–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**: `git@github.com:nirudef/aoka_api.git`
- **Frontend (–∫–ª–∏–µ–Ω—Ç)**: `aoka-web` ‚Üí `NEXT_PUBLIC_API_URL=https://api.aoka.kz`
- **VPS (Deploy)**: `aoka-prod-01 (Almaty, Kazakhstan)`

---

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è                                                 |
|----------|------------------------------------------------------------|
| **–Ø–∑—ã–∫** | Ruby 3.3+                                                  |
| **–§—Ä–µ–π–º–≤–æ—Ä–∫** | Ruby on Rails 8.0 (API-only)                               |
| **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö** | PostgreSQL 14+ (`uuid` –≤ –∫–∞—á–µ—Å—Ç–≤–µ primary key)             |
| **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** | `authentication-zero` + –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏ (`signed_id`)   |
| **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è** | `globalize` (–ø–µ—Ä–µ–≤–æ–¥—ã —Å—Ç–∞—Ç–µ–π, –∫–∞—Ç–µ–≥–æ—Ä–∏–π, —Ñ–∏–ª–∏–∞–ª–æ–≤, –∫–æ–Ω—Ç–æ—Ä) |
| **–ß–ü–£** | `friendly_id` (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∏—Ä–∏–ª–ª–∏—Ü—ã `ru/kk`)             |
| **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** | RSpec, FactoryBot, DatabaseCleaner                         |
| **CI/CD** | GitLab CI ‚Üí Deploy via Capistrano/SSH                      |

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

aoka-api/
‚îú‚îÄ‚îÄ app/
‚îÇ ‚îú‚îÄ‚îÄ controllers/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ api/
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ v1/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ articles_controller.rb # CRUD —Å—Ç–∞—Ç–µ–π
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ categories_controller.rb # CRUD –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ branches_controller.rb # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–ª–∏–∞–ª–∞–º–∏
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ law_offices_controller.rb # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–æ—Ä–∞–º–∏
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ users_controller.rb # CRUD –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (admin only)
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ sessions_controller.rb # /login, /logout
‚îÇ ‚îú‚îÄ‚îÄ models/
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ article.rb # –ü—É–±–ª–∏–∫–∞—Ü–∏–∏ (–Ω–æ–≤–æ—Å—Ç–∏, –∫–æ–Ω–∫—É—Ä—Å—ã)
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ article_translation.rb # –ü–µ—Ä–µ–≤–æ–¥—ã —Å—Ç–∞—Ç–µ–π
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ category.rb # –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ (news, contest, ...)
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ category_translation.rb # –ü–µ—Ä–µ–≤–æ–¥—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–π
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ branch.rb # –§–∏–ª–∏–∞–ª—ã
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ branch_translation.rb # –ü–µ—Ä–µ–≤–æ–¥—ã —Ñ–∏–ª–∏–∞–ª–æ–≤
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ law_office.rb # –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ –∫–æ–Ω—Ç–æ—Ä—ã
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ law_office_translation.rb # –ü–µ—Ä–µ–≤–æ–¥—ã –∫–æ–Ω—Ç–æ—Ä
‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ user.rb # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (advocate, accountant, admin)
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ session.rb # –°–µ—Å—Å–∏–∏ –¥–ª—è authentication-zero
‚îÇ ‚îî‚îÄ‚îÄ jobs/ # Background jobs (–≤ –±—É–¥—É—â–µ–º)
‚îú‚îÄ‚îÄ config/
‚îÇ ‚îú‚îÄ‚îÄ routes.rb # RESTful API –º–∞—Ä—à—Ä—É—Ç—ã
‚îÇ ‚îî‚îÄ‚îÄ initializers/
‚îÇ ‚îî‚îÄ‚îÄ friendly_id.rb # –¢—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏—è –∫–∏—Ä–∏–ª–ª–∏—Ü—ã (ru/kk)
‚îú‚îÄ‚îÄ db/
‚îÇ ‚îú‚îÄ‚îÄ migrate/ # –ú–∏–≥—Ä–∞—Ü–∏–∏ (uuid, translations, indexes)
‚îÇ ‚îî‚îÄ‚îÄ seeds.rb # –°–∏–¥—ã: –∫–∞—Ç–µ–≥–æ—Ä–∏–∏, –¥–µ–º–æ-—Å—Ç–∞—Ç—å–∏, –∞–¥–º–∏–Ω
‚îî‚îÄ‚îÄ spec/ # RSpec —Ç–µ—Å—Ç—ã

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

### 1. **–°–µ—Å—Å–∏–∏ —á–µ—Ä–µ–∑ `authentication-zero`**
- –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏: `POST /api/v1/sessions` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `token: session.signed_id`
- –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è: –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Authorization: Token <signed_id>`
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å: `signed_id` ‚Äî –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–π ID —Å–µ—Å—Å–∏–∏ (–Ω–µ JWT)

### 2. **–†–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π**
```ruby
enum role: {
  guest: 'guest',
  lawyer: 'lawyer',       # –ê–¥–≤–æ–∫–∞—Ç
  accountant: 'accountant', # –ë—É—Ö–≥–∞–ª—Ç–µ—Ä
  branch_head: 'branch_head', # –ó–∞–≤. —Ñ–∏–ª–∏–∞–ª–æ–º
  admin: 'admin'          # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä
}
```

### 3. –ü–æ–ª–∏—Ç–∏–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- /api/v1/users ‚Äî —Ç–æ–ª—å–∫–æ admin
- /api/v1/articles ‚Äî –ø—É–±–ª–∏—á–Ω—ã–π (GET), admin (POST/PUT/DELETE)
- /api/v1/profile ‚Äî —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ

## üåê –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (globalize)

#### –ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞:
```ruby
GET /api/v1/articles?lang=kk
‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç—å–∏ —Å –ø–µ—Ä–µ–≤–æ–¥–∞–º–∏ –Ω–∞ –∫–∞–∑–∞—Ö—Å–∫–∏–π
```

#### Fallback-–ª–æ–≥–∏–∫–∞:
```ruby
# config/initializers/globalize.rb
Globalize.fallbacks = {
  kk: [:kk, :ru, :en],
  en: [:en, :ru, :kk],
  ru: [:ru, :kk, :en]
}
```

## üî§ –ß–ü–£ (friendly_id)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç—Ä–∞–Ω—Å–ª–∏—Ç–µ—Ä–∞—Ü–∏–∏ –∫–∏—Ä–∏–ª–ª–∏—Ü—ã
```ruby
# config/initializers/friendly_id.rb
def normalize_friendly_id(text)
  text
    .gsub(/”ô|–∞ÃÅ/, 'a').gsub(/“ì|—ì/, 'g').gsub(/“õ|—ú/, 'k')
    .gsub(/“£|–ΩÃÅ/, 'n').gsub(/”©|–æÃÅ/, 'o').gsub(/“±|—ÉÃÅ/, 'u')
    .gsub(/“Ø|—ãÃÅ/, 'u').gsub(/“ª|—ÖÃÅ/, 'h').gsub(/—ñ|–∏ÃÅ/, 'i')
    .gsub(/[—ä—å]/, '')
    .then { |s| I18n.transliterate(s, locale: :ru) }
    .downcase
    .gsub(/[^a-z0-9\s\-]/, '')
    .gsub(/\s+/, '-')
    .gsub(/-+/, '-')
    .gsub(/^-|-$/, '')
end
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–ª–æ–∫–∞–ª—å–Ω–æ)
### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Ruby 3.1+, Rails 7.1+, PostgreSQL 14+

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞
```ruby
git clone git@github.com:nirudef/aoka_api.git
cd aoka-api
bundle install
rails db:setup        # create + migrate + seed
rails s -p 3001
```

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è
–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω –¥–ª—è –ê–ª–º–∞—Ç–∏–Ω—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–Ω–æ–π –∫–æ–ª–ª–µ–≥–∏–∏ –∞–¥–≤–æ–∫–∞—Ç–æ–≤.
–ö–æ–¥ –∑–∞–∫—Ä—ã—Ç—ã–π, —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ –±–µ–∑ –ø–∏—Å—å–º–µ–Ω–Ω–æ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è.
